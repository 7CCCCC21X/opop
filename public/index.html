<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>Superchain ç§¯åˆ†æ‰¹é‡æŸ¥è¯¢</title>
  <style>
    body { font-family: sans-serif; max-width: 900px; margin: auto; padding: 30px; }
    input, button { padding: 10px; margin: 5px 0; font-size: 14px; }
    table { width: 100%; margin-top: 20px; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; font-size: 14px; }
    th { background: #f0f0f0; }
    #log { font-size: 13px; color: gray; margin-top: 10px; }
  </style>
</head>
<body>

  <h2>Superchain ç§¯åˆ†æ’è¡Œæ¦œæ‰¹é‡æŸ¥è¯¢</h2>
  <label>èµ·å§‹é¡µç ï¼š<input type="number" id="startPage" value="1" min="1" /></label><br>
  <label>æœ€å¤§é¡µç ï¼š<input type="number" id="maxPage" value="5" min="1" /></label><br>
  <button onclick="fetchData()">å¼€å§‹æŸ¥è¯¢</button>

  <div id="log"></div>

  <table id="resultTable" style="display:none;">
    <thead>
      <tr>
        <th>#</th>
        <th>åœ°å€</th>
        <th>ç§¯åˆ†</th>
        <th>å¾½ç« æ•°</th>
        <th>SuperChain ID</th>
      </tr>
    </thead>
    <tbody id="resultBody"></tbody>
  </table>

  <script>
    async function fetchData() {
      const startPage = parseInt(document.getElementById("startPage").value);
      const maxPage = parseInt(document.getElementById("maxPage").value);
      const tbody = document.getElementById("resultBody");
      const table = document.getElementById("resultTable");
      const log = document.getElementById("log");

      tbody.innerHTML = "";
      table.style.display = "table";
      log.innerText = "â³ å¼€å§‹æŸ¥è¯¢ä¸­...";

      let index = 1;
      for (let page = startPage; page <= maxPage; page++) {
        log.innerText = `ğŸ“„ æ­£åœ¨åŠ è½½ç¬¬ ${page} é¡µ...`;

        try {
          const res = await fetch(`/api/leaderboard?page=${page}`);
          const json = await res.json();
          const list = json.data || [];

          for (const item of list) {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${index++}</td>
              <td>${item.superaccount}</td>
              <td>${item.total_points}</td>
              <td>${item.total_badges}</td>
              <td>${item.superChainId}</td>
            `;
            tbody.appendChild(row);
          }

          if (!json.hasNextPage) {
            log.innerText = `âœ… å·²åˆ°æœ€åä¸€é¡µï¼ˆç¬¬ ${page} é¡µï¼‰ï¼ŒæŸ¥è¯¢å®Œæˆ`;
            break;
          }
        } catch (err) {
          log.innerText = `âŒ ç¬¬ ${page} é¡µæŸ¥è¯¢å¤±è´¥ï¼š${err.message}`;
          break;
        }
      }

      log.innerText = `âœ… å…±åŠ è½½ ${index - 1} æ¡æ•°æ®`;
    }
  </script>

</body>
</html>
